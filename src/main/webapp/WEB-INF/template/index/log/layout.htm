<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<#include "../public/common.inc.htm">
<#include "../public/resource.inc.htm">
<table class="listAction" url="<@url action="list" />" toolbar="#toolbar" pagination="true" rownumbers="true" fitcolumns="true" fit="true" border="false" singleselect="false" nowrap="true" checkonselect="true" selectoncheck="true">
	<thead>
		<tr>
			<th checkbox="true"></th>
			<th field="id">ID</th>
			<th field="name">名称</th>
			<th field="type">类型</th>
			<th field="module">模块</th>
			<th field="controller">控制器</th>
			<th field="action">方法</th>
			<th field="member">操作者</th>
			<th field="ip">IP</th>
			<th field="createTime">操作时间</th>
			<th field="result">操作结果</th>
			<th field="request">请求参数</th>
		</tr>
	</thead>
</table>
<div id="toolbar" class="controllerBar">
	<#if _BASE_.hasPermit("delete")><a id="buttonDelete" href="javascript:void(0);" class="easyui-linkbutton" iconcls="icon-remove" plain="true">删除</a></#if>
	<#if _BASE_.hasPermit("truncate")><a id="buttonTruncate" href="javascript:void(0);" class="easyui-linkbutton" iconcls="icon-truncate" plain="true">清空</a></#if>
	<#if _BASE_.hasPermit("editSetting")><a href="<@url action="editSetting" />" class="easyui-linkbutton" iconcls="icon-type" plain="true">参数设置</a></#if>
	<a id="searchAction" href="javascript:void(0);" class="easyui-linkbutton" iconcls="icon-search" plain="true">搜索</a>
</div>
<div class="searchActionDialog" style="width:230px;height:308px" data-options="buttons:'#actionButton',modal:true,resizable:true">
<table align="center" class="horizontalTable trHeight25">
	<tr>
		<th>开始日期</th>
		<td>
			<input type="text" class="easyui-datebox width130" id="timeStart" value="" />
		</td>
	</tr>
	<tr>
		<th>结束日期</th>
		<td>
			<input type="text" class="easyui-datebox width130" id="timeEnd" value="" />
		</td>
	</tr>
	<tr>
		<th>类型</th>
		<td>
			<input class="easyui-validatebox inputText width130" type="text" name="type" value="" />
		</td>
	</tr>
	<tr>
		<th>模块</th>
		<td>
			<input class="easyui-validatebox inputText width130" type="text" name="module" value="" />
		</td>
	</tr>
	<tr>
		<th>控制器</th>
		<td>
			<input class="easyui-validatebox inputText width130" type="text" name="controller" value="" />
		</td>
	</tr>
	<tr>
		<th>方法</th>
		<td>
			<input class="easyui-validatebox inputText width130" type="text" name="action" value="" />
		</td>
	</tr>
	<tr>
		<th>用户</th>
		<td>
			<input class="easyui-validatebox inputText width130" type="text" name="member" value="" />
		</td>
	</tr>
	<tr>
		<th>IP</th>
		<td>
			<input class="easyui-validatebox inputText width130" type="text" name="ip" value="" />
		</td>
	</tr>
</table>
</div>
<div id="actionButton">
	<a href="javascript:void(0);" class="easyui-linkbutton searchActionOK" data-options="iconCls:'icon-search'">搜索</a>
	<a href="javascript:void(0);" class="easyui-linkbutton searchActionCancel" data-options="iconCls:'icon-cancel'">取消</a>
</div>
<script>
$(function () {
	$('#searchAction').bind('click', function () {
		$('.searchActionDialog').dialog({
			title : '筛选条件',
			iconCls : 'icon-search',
			onOpen : function () {}
		});
	});
		
	$('.searchActionOK').unbind('click.action').bind('click.action' ,function () {
		$('.listAction').datagrid('load', {
			timeStart : $('#timeStart').datebox('getValue'),
			timeEnd : $('#timeEnd').datebox('getValue'),
			type : $('input[name="type"]').val(),
			module : $('input[name="module"]').val(),
			controller : $('input[name="controller"]').val(),
			action : $('input[name="action"]').val(),
			member : $('input[name="member"]').val(),
			ip : $('input[name="ip"]').val()
		});
		$('.searchActionDialog').dialog('close');
	})
	$('.searchActionCancel').unbind('click.action').bind('click.action' ,function () {
		$('.searchActionDialog').dialog('close');
	});
	$('.listAction').datagrid({
		onSelectAll : function (rows) {
			for(i = 0; i < rows.length; i++) {
				$(this).datagrid('selectRecord', rows[i].id);
			}
		},
		onUnselectAll : function (rows) {
			for(i = rows.length - 1; i >= 0; i--) {
				$(this).datagrid('unselectRow', $(this).datagrid('getRowIndex', rows[i]));
			}
		},
		onDblClickRow : function (rowIndex, rowData) {}
	});
	$('#buttonDelete').bind('click', function () {
		var rows = $('.listAction').treegrid('getChecked');
		var ids = '', size = rows.length;
		if(size < 1) {
			Web_alertInfo('请选择要删除的记录！');
			return ;
		}
		for(var i = 0; i < size; i++) {
			var row = rows[i];
			ids += row.id;
			if(i + 1 < size) {
				ids += ',';
			}
		}
		var url = '<@url action="delete" />?ids=' + ids;
		$.getJSON(url, function(data) {
			if(0 == data.status) {
				Web_confirm(data.message + '重新载入当前页面......', function (result) {
					$('.listAction').datagrid('reload');
					$('.listAction').datagrid('unselectAll');
				});
			} else {
				Web_alertInfo(data.message);
			}
		});
	});
	$('#buttonTruncate').bind('click', function () {
		var url = '<@url action="truncate" />';
		$.getJSON(url, function(data) {
			if(0 == data.status) {
				Web_confirm(data.message + '重新载入当前页面......', function (result) {
					$('.listAction').datagrid('reload');
					$('.listAction').datagrid('unselectAll');
				});
			} else {
				Web_alertInfo(data.message);
			}
		});
	});
});
</script>